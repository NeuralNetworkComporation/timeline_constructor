{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>üíº –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π</h2>
        <a href="{% url 'ai_search_dashboard' %}" class="btn btn-outline-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∏—Å–∫—É</a>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">{{ profile.title }}</h5>
            <p class="card-text"><strong>–ò–¥–µ–∞–ª—å–Ω–∞—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å:</strong> {{ profile.ideal_position }}</p>
            <p class="card-text">
                <small class="text-muted">
                    –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: {{ profile.min_match_percentage }}% |
                    –ù–∞–π–¥–µ–Ω–æ –≤–∞–∫–∞–Ω—Å–∏–π: {{ matches|length }}
                </small>
            </p>
        </div>
    </div>

    {% if matches %}
    <div class="row">
        {% for match in matches %}
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title">{{ match.matched_vacancy.title }}</h5>
                        <span class="badge bg-success fs-6">{{ match.match_percentage }}%</span>
                    </div>

                    <p class="card-text">
                        <strong>–ö–æ–º–ø–∞–Ω–∏—è:</strong> {{ match.matched_vacancy.company.name }}<br>
                        <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ match.matched_vacancy.description|truncatewords:20 }}
                    </p>

                    {% if match.match_details.explanation %}
                    <p class="card-text">
                        <small>{{ match.match_details.explanation }}</small>
                    </p>
                    {% endif %}
                </div>
                <div class="card-footer">
                    <div class="d-grid gap-2">
                        <a href="{% url 'vacancy_detail' match.matched_vacancy.id %}" class="btn btn-primary btn-sm">
                            üëÄ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">
        <h5>–í–∞–∫–∞–Ω—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.</p>
        <a href="{% url 'create_ideal_vacancy_profile' %}" class="btn btn-outline-primary">
            –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–∏—Å–∫–∞
        </a>
    </div>

    {% endif %}
</div>
<div class="alert alert-info">
    <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è: "{{ profile.title }}"</h4>
    <p>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥: {{ profile.min_match_percentage }}%</p>
    <a href="{% url 'run_ai_search' profile.id %}" class="btn btn-sm btn-warning">
        üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    </a>
</div>
{% endblock %}