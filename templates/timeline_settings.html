{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 fade-in">
            <div class="glass-card p-4">
                <div class="text-center mb-4">
                    <h2 class="fw-bold gradient-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–ª–∞–π–Ω–∞</h2>
                    <p class="text-muted">{{ timeline.title }}</p>
                </div>

                {% if form.errors %}
                <div class="alert alert-danger">
                    <strong>–û—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ:</strong>
                    <ul>
                        {% for field, errors in form.errors.items %}
                            {% for error in errors %}
                                <li>{{ field }}: {{ error }}</li>
                            {% endfor %}
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                <form method="post" novalidate>
                    {% csrf_token %}

                    <div class="row g-3">
                        <!-- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ -->
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞</label>
                            <select name="color_scheme" class="form-select">
                                <option value="green" {% if form.color_scheme.value == 'green' %}selected{% endif %}>üü¢ –ó–µ–ª–µ–Ω–∞—è</option>
                                <option value="blue" {% if form.color_scheme.value == 'blue' %}selected{% endif %}>üîµ –°–∏–Ω—è—è</option>
                                <option value="purple" {% if form.color_scheme.value == 'purple' %}selected{% endif %}>üü£ –§–∏–æ–ª–µ—Ç–æ–≤–∞—è</option>
                                <option value="orange" {% if form.color_scheme.value == 'orange' %}selected{% endif %}>üü† –û—Ä–∞–Ω–∂–µ–≤–∞—è</option>
                                <option value="red" {% if form.color_scheme.value == 'red' %}selected{% endif %}>üî¥ –ö—Ä–∞—Å–Ω–∞—è</option>
                                <option value="teal" {% if form.color_scheme.value == 'teal' %}selected{% endif %}>ü©µ –ë–∏—Ä—é–∑–æ–≤–∞—è</option>
                            </select>
                            {% if form.color_scheme.errors %}
                                <div class="text-danger small mt-1">{{ form.color_scheme.errors }}</div>
                            {% endif %}
                        </div>

                        <!-- –ú–∞–∫–µ—Ç -->
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">–ú–∞–∫–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                            <select name="layout" class="form-select">
                                <option value="vertical" {% if form.layout.value == 'vertical' %}selected{% endif %}>üìè –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π</option>
                                <option value="horizontal" {% if form.layout.value == 'horizontal' %}selected{% endif %}>‚ÜîÔ∏è –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π</option>
                                <option value="centered" {% if form.layout.value == 'centered' %}selected{% endif %}>üéØ –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
                            </select>
                            {% if form.layout.errors %}
                                <div class="text-danger small mt-1">{{ form.layout.errors }}</div>
                            {% endif %}
                        </div>

                        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                        <div class="col-12">
                            <h5 class="fw-semibold mt-4 mb-3">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" name="show_dates" id="show_dates"
                                               {% if form.show_dates.value %}checked{% endif %}>
                                        <label class="form-check-label fw-semibold" for="show_dates">
                                            üìÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞—Ç—ã
                                        </label>
                                    </div>

                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" name="show_images" id="show_images"
                                               {% if form.show_images.value %}checked{% endif %}>
                                        <label class="form-check-label fw-semibold" for="show_images">
                                            üñºÔ∏è –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                        </label>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" name="allow_comments" id="allow_comments"
                                               {% if form.allow_comments.value %}checked{% endif %}>
                                        <label class="form-check-label fw-semibold" for="allow_comments">
                                            üí¨ –†–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                                        </label>
                                    </div>

                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" name="is_public" id="is_public"
                                               {% if form.is_public.value %}checked{% endif %}>
                                        <label class="form-check-label fw-semibold" for="is_public">
                                            üåê –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                        <div class="col-12 mt-4">
                            <div class="d-flex gap-3 justify-content-end">
                                <a href="{% url 'timeline_edit' timeline.pk %}" class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>–ù–∞–∑–∞–¥ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                                </button>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <div class="mt-5 pt-4 border-top">
                    <h5 class="fw-semibold mb-3">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <a href="{% url 'timeline_export' timeline.pk %}"
   class="btn btn-outline-primary w-100"
   download="{{ timeline.title|slugify }}.json">
    <i class="fas fa-download me-2"></i>–≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
</a>
                        </div>
                        <div class="col-md-4">
                            <a href="{% url 'timeline_duplicate' timeline.pk %}" class="btn btn-outline-success w-100">
                                <i class="fas fa-copy me-2"></i>–°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="{% url 'timeline_delete' timeline.pk %}" class="btn btn-outline-danger w-100">
                                <i class="fas fa-trash me-2"></i>–£–¥–∞–ª–∏—Ç—å —Ç–∞–π–º–ª–∞–π–Ω
                            </a>
                        </div>
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="mt-4 pt-4 border-top">
                    <h5 class="fw-semibold mb-3">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–π–º–ª–∞–π–Ω–∞</h5>
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="h4 text-primary mb-0">{{ timeline.events.count }}</div>
                            <small class="text-muted">–°–æ–±—ã—Ç–∏–π</small>
                        </div>
                        <div class="col-4">
                            <div class="h4 text-success mb-0">{{ timeline.views.count }}</div>
                            <small class="text-muted">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</small>
                        </div>
                        <div class="col-4">
                            <div class="h4 text-warning mb-0">{{ timeline.likes.count }}</div>
                            <small class="text-muted">–õ–∞–π–∫–æ–≤</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}